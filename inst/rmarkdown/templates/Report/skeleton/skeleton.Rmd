---
title: "Data Cleaning and analysis"
subtitle: "Supplemental Materials: R Code Workflow"
author: "Chaopai Lin"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: True
      smooth_scroll: false
    code_download: true
    anchor_sections: true
    # df_print: kable
    highlight: pygments
editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style type="text/css">
  body { font-family: "Source Sans Pro", Arial, sans-serif;
         font-size: 14px; color: #000;}
  #header { text-align: center; }
  h1, h2, h3 { font-weight: bold; }
  h1.title { font-size: 34px; }
  h1 { font-size: 32px; }
  h2 { font-size: 28px; }
  h3 { font-size: 24px; }
  h4 { font-size: 20px; }
  #TOC li { font-size: 18px; line-height: 1.25; }
  p, li, button span { font-size: 16px; }
  .table { table-layout: fixed; width: auto; margin: 1em auto; }
  .table thead { background-color: #f0f0f0; }
  .table tr.even { background-color: #f5f5f5; }
  .table { border-top: 1px solid #111; border-bottom: 1px solid #111; }
  .table thead tr th { border-bottom-width: 0px; line-height: 1.2; }
  .table tbody tr td { border-top-width: 0px; line-height: 1.2; }
  pre code { font-family: "Consolas", "Monaco", monospace;}
  pre code span.do { font-weight: bold; }
  pre code span.fu { color: #8959a8; }
</style>
```

```{r Config, include=FALSE}
options(
  knitr.kable.NA = "",
  digits = 3
)
knitr::opts_chunk$set(
  echo = FALSE,
  # collapse = TRUE,
  comment = "",
  fig.width = 8,
  fig.height = 6,
  dpi = 500
)
```

#  Analysis Flow
A flowchart should be displayed here.

# Setting
## Packages and Directory

```{r, echo = TRUE, results='hide', message=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
library(naniar)
library(table1)
library(psych)
library(MplusAutomation)
library(Lin)
library(bruceR)
library(glue)

set.wd()
```

# Data Preparation
## Import

```{r, echo=TRUE}

```


# Methods
## Demographic

```{r}
# Change the syntax based on your requirements
library(haven)
data_factor <- mutate(data, across(where(is.labelled), as_factor))

table1( ~ var1 + var2 + var3 | group, 
       data = data_factor,
       caption = glue("Table x. Demographic Information (N = {nrow(data_factor)})."))
```

## Reliability

```{r}
# single factor or multi-factor model
spec_sf <- 'F1 =~ x1 + x2 + x3 + x4'
spec_mf <- paste0(
  'F1 =~ x1 + x2 + x3', '\\n',
  'F2 =~ y1 + y2 + y3 + y4'
)

rel_all <- reliability_table(spec_sf, spec_mf, data = my_data)

# rel_all the final result
rel_result %>% 
  apa(title = "Table x. Reliability test.", digits = 3)
```

# Results
## Primary Analysis

```{r}
data %>% 
  select(x, y, m:z) %>% 
  describe() %>% 
  select(-"vars") %>% 
  apa(title = "Table x. Descriptive analysis.")
```

## Correlation

```{r}
cor_data <- select(data, 
                   gender, age, x, y)

cor_table(cor_data, vars = names(cor_data), stats_position = "bottom") %>% 
  apa(title = str_glue("Table x. Descriptive statistics and zero-order bivariate correlations between variables (n = {nrow(data_final)})."))
```

## Models
```{r}

```

