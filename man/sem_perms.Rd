% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sem_perms.R
\name{sem_perms}
\alias{sem_perms}
\title{Run all permutations of a mediation/moderation SEM in Mplus}
\usage{
sem_perms(
  data,
  latent_defs,
  roles = c("x", "m1", "m2", "y"),
  covariate = c("gender", "age"),
  extra_var = NULL,
  exclusion = exclusive_groups,
  fix = fixed_groups,
  analysis = "esti = ml;",
  structural_tpl,
  output = "stand;",
  out_dir = "./Mplus",
  parameters = "med",
  ...
)
}
\arguments{
\item{data}{A data.frame containing all manifest indicators and covariates.}

\item{latent_defs}{A named character vector of measurement model strings.
E.g.
```r
c(
  x = "x by x1 x2 x3;",
  m1 = "m1 by m11 m12 m13;",
  …
)
```}

\item{roles}{Character vector of latent roles to permute (default `c("x","m1","m2","y")`).}

\item{covariate}{Character vector of covariate names included in every model
(default `c("gender","age")`).}

\item{extra_var}{Optional character vector of additional manifest variables.}

\item{exclusion}{List of vectors: each vector lists roles that should not
co‐occur in the same model.}

\item{fix}{Named list: each element is a vector of roles allowed
for one slot (e.g. `list(x = c("x","w"))`).}

\item{analysis}{String passed to Mplus “ANALYSIS:” (default `"esti = ml;"`).}

\item{structural_tpl}{User‐supplied glue template for the “MODEL:” block.}

\item{output}{String passed to Mplus “OUTPUT:” (default `"stand;"`).}

\item{out_dir}{Directory in which to write `.inp` and `.out` files
(default `"./Mplus/med"`).}

\item{parameters}{Character vector of parameter labels whose p‐values
you wish to extract (i.e., `"med"`).}

\item{...}{Additional arguments (currently unused).}
}
\value{
A data.frame combining Mplus fit indices (via `fit_table()`) and
        p‐values for the specified parameters, with one row per model.
}
\description{
Automatically generates Mplus “.inp” files for every permutation
             of specified latent roles, runs them, and returns a combined
             data.frame of fit indices plus user‐requested parameter p‐values.
             Supports exclusion/fix rules, custom structural templates,
             covariates, and robust error‐handling with progress bars.
}
\details{
-----------------------------------------------------------------------------


- Creates one `.inp` per permutation of `roles`.
- Honors `exclusion` and `fix` constraints.
- Writes data via `prepareMplusData()`, runs models with `runModels()` and
  a CLI progress bar (errors are caught and logged).
- Reads results with `readModels()`, builds fit‐index table, then appends
  requested p‐values.
}
\examples{
\dontrun{
# Example 1: chain mediation
data("latent_data")

# Define measurement model for each varaible,
# must formatted without hyphen, "x1 x2 x3" rather than "x1-x3"
latent_defs <- c(
  x  = "x by x1 x2 x3;",
  m1 = "m1 by m11 m12 m13;",
  m2 = "m2 by m21 m22 m23 m24 m25;",
  y  = "y by y1 y2 y3 y4;",
  z  = "z by z1 z2 z3;",
  w  = "w by w1 w2 w3 w4;"
)

#-- set up sample constraints for the examples ------------------------------

structural_tpl_chain <- "
  {m1} ON {x}
  {cov};
  {m2} ON {x}
  {m1}
  {cov};
  {y} ON {x}
  {m1}
  {m2}
  {cov};

  model constraint:
  new(med1-med3);
  med1 = a1 * b1;
  med2 = a2 * b2;
  med3 = a1 * d * b2;"

out1 <- sem_perms(
  data          = latent_data,
  latent_defs   = latent_defs,
  structural_tpl= structural_tpl_chain,
  covariate     = c("age", "gender"),
  out_dir       = "./Mplus",
  parameters = c("med1", "med2", "med3")
)

# Example 2: moderation
structural_tpl_mod <- "
  int | {x} xwith {w};
  {y} ON {x} {w} int {cov};
"

out2 <- sem_perms(
  data            = latent_data,
  latent_defs     = latent_defs,
  roles           = c("x", "w", "y"),
  structural_tpl  = structural_tpl_mod,
  covariate       = c("age", "gender"),
  parameters      = c("int"),
  analysis = "type = random;",
  out_dir         = "./Mplus/moderation"
)
}
}
