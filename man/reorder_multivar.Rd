% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reorder_multivar.R
\name{reorder_multivar}
\alias{reorder_multivar}
\title{Reorder Data Blocks to Achieve Target Multivariate Correlation Structure}
\usage{
reorder_multivar(data, blocks, target_cor, anchor)
}
\arguments{
\item{data}{A data.frame containing the variables to be reordered.}

\item{blocks}{A named list defining the variable blocks.
\itemize{
  \item **Names**: Must match the row/column names of \code{target_cor}.
  \item **Values**: Character vectors of column names in \code{data}.
  \item The **first variable** in each vector is treated as the "Representative" (Score).
        Its values determine the sorting order for that block and are used for correlation control.
  \item All variables in the vector move together as a unit to preserve intra-block relationships.
}
Example: \code{list(x = c("x", "x1"), m = c("m", "m1"))}.}

\item{target_cor}{A symmetric numeric matrix representing the desired Spearman rank correlation
structure between the block representatives. Row and column names must match the names of the \code{blocks} list.}

\item{anchor}{A character string specifying which block name (from \code{blocks}) acts as the Anchor.
The Anchor block is **never moved**.}
}
\value{
A data.frame with the same dimensions as \code{data}. Columns belonging to non-anchor blocks
  are reordered. Columns not specified in \code{blocks} (e.g., demographics) remain in their original positions.
}
\description{
This function reorders blocks of variables within a dataset so that the Spearman rank
correlations between the "representative" variables of each block match a specified target matrix.
It uses the Iman-Conover (1982) method. The function preserves the internal structure of each block
(intra-block correlations) and keeps the anchor block (and any unspecified columns) fixed in their original rows.
}
\examples{
# --- Example 1: Standard Usage ---

# 1. Create dummy data with block structures
N <- 1000
df <- data.frame(
  # Demographics (Should not change relative to Anchor)
  id = 1:N,
  gender = sample(c("M", "F"), N, replace = TRUE),
  # Block X (Anchor): x is the score
  x = rnorm(N), x_item1 = rnorm(N), x_item2 = rnorm(N), x_item3 = rnorm(N),
  # Block M: m is the score
  m = runif(N), m_item1 = runif(N), m_item2 = runif(N), m_item3 = runif(N),
  # Block Y: y is the score
  y = rbeta(N, 2, 2), y_item1 = rbeta(N, 1, 1), y_item2 = rbeta(N, 1, 1), y_item3 = rbeta(N, 1, 1)
)
# 2. Define Block Structure
# Keys (x, m, y) match the target matrix.
# First value in vector is the representative.
block_def <- list(
  x = c("x", "x_item1", "x_item2", "x_item3"),
  m = c("m", "m_item1", "m_item2", "m_item3"),
  y = c("y", "y_item1", "y_item2", "y_item3")
)

# 3. Define Target Matrix (x-m: 0.5, x-y: 0.3, m-y: 0.4)
target_mat <- matrix(c(
  1.0, 0.5, 0.3,
  0.5, 1.0, 0.4,
  0.3, 0.4, 1.0
), nrow = 3, dimnames = list(c("x", "m", "y"), c("x", "m", "y")))

# 4. Run function
df_new <- reorder_multivar(df, block_def, target_mat, anchor = "x")

# 5. Validate
# Check correlations of representatives
print(cor(df_new[, c("x", "m", "y")], method = "spearman"))

# Check if 'id' matches 'x' (Anchor didn't move)
print(all(df_new$x == df$x))     # TRUE
print(all(df_new$id == df$id))   # TRUE

# Check intra-block integrity (m vs m_item1 correlation should be unchanged)
print(cor(df$m, df$m_item1))
print(cor(df_new$m, df_new$m_item1))


# --- Example 2: Non-Positive Semi-Definite Matrix (Error Handling) ---

# Impossible structure: x strongly correlated to m and y (0.9),
# but m and y are negatively correlated (-0.9).
# This violates the triangle inequality.
bad_mat <- matrix(c(
  1.0, 0.9, 0.9,
  0.9, 1.0, -0.9,
  0.9, -0.9, 1.0
), nrow = 3, dimnames = list(c("x", "m", "y"), c("x", "m", "y")))

  # This will throw an error and provide a suggestion
  reorder_multivar(df, block_def, bad_mat, anchor = "x")

}
